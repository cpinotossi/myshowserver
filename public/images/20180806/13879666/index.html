<!doctype html>
<html>
	<head>
		<title>Akamai Image Comparison</title>
		<style>
body {
	margin:           auto;
	padding:          1em;
	font-family:      Helvetica, Sans-Serif;
	font-size:        12pt;
	background-color: #222;
	color:            #ddd;
}

h1 {
	margin-top: 0;
	font-size:  16pt;
}

#comparison {
	display: inline-block;
	margin:  auto;
	width:   auto;
}

#controls {
	width:            325pt;
	padding:          0.5em 0 0 0;
	text-align:       left;
	background-color: #444;
	float:            left;
}

#controls fieldset {
	margin:  0;
	border:  0;
	padding: 4pt 8pt;
}

#controls fieldset header {
	font-size:      12pt;
	font-weight:    bold;
	padding:        0;
	padding-bottom: 0.25em;
}

#controls fieldset fieldset {
	display: inline-block;
	padding: 4pt 10pt;
}

#controls fieldset fieldset header {
	font-weight: normal;
}

#controls label {
	display:      inline-block;
	margin-right: 1em;
}

#staticQualityControls label {
	min-width: 5em;
}

#perceptualQualityControls label {
	min-width: 8em;
}

#controls input {
	margin-right: 0.5em;
}

#imageName {
	max-width: 300pt;
}

#imageData {
	background-color: #333;
	padding:          4pt 8pt;
	font-size:        9pt;
	text-align:       left;
}

#imageData table {
	width: 100%;
	border-collapse: collapse;
}

#imageData table td, #imageData table th {
	text-align:    right;
	padding-right: 4pt;
	padding-left:  4pt;
}

#imageData table td {
	font-family: Monospace;
}

#viewer {
	margin-left: 325pt;
}

#viewerImageContainer {
	background-color: #666;
	background-image:
		linear-gradient( 45deg, #555 25%, transparent 25%),
		linear-gradient(-45deg, #555 25%, transparent 25%),
		linear-gradient( 45deg, transparent 75%, #555 75%),
		linear-gradient(-45deg, transparent 75%, #555 75%);
	background-size: 32pt 32pt;
	background-position: 0 0, 0pt 16pt, 16pt 16pt, 16pt 0pt;
}

#viewerImageContainer img {
	display: block;
	margin:  auto;
}

.hotkeyMarker {
	text-decoration: underline;
}

.tooltipper {
	-webkit-text-decoration: underline dashed;
	text-decoration:         underline dashed;
}

input[type=radio] {
	-webkit-appearance: none;
	appearance:         none;
	background-color:   #333;
	color:              #ddd;
	border:             0;
	border-radius:      50%;
	margin:             0 0.5em 0.25em 0;
	padding:            0;
	width:              1.5em;
	height:             1.5em;
	text-align:         center;
	vertical-align:     middle;
	font-size:          11pt;
}

input[type=radio]:checked {
	background-color: #222;
}

input[type=radio]:checked::after {
	display:          block;
	border:           0;
	border-radius:    50%;
	padding:          0;
	margin:           0.5em;
	width:            0.5em;
	height:           0.5em;
	background-color: #ddd;
	content:          " ";
}

		</style>
	</head>
	<body>
		<h1 id="mainTitle">Akamai Image Comparison</h1>
		<div id="comparison">
			<div id="controls">
				<form>
					<fieldset id="imageControls">
						<header>Image:</header>
						<select id="imageName" class="input">
						</select>
					</fieldset>
					<fieldset id="scenarioControls">
						<header><span class="hotkeyMarker">S</span>cenario:</header>
					</fieldset>
					<fieldset id="breakpointControls">
						<header><span class="hotkeyMarker">B</span>reakpoint:</header>
					</fieldset>
					<fieldset id="subSamplingControls">
						<header><span class="hotkeyMarker">C</span>hroma Subsampling Quality:</header>
					</fieldset>
					<fieldset id="qualityControls">
						<header><span class="hotkeyMarker">Q</span>uality:</header>
						<fieldset id="staticQualityControls">
							<header>Static:</header>
						</fieldset>
						<fieldset id="perceptualQualityControls">
							<header>Perceptual:</header>
						</fieldset>
					</fieldset>
					<fieldset id="displayControls">
						<header><span class="hotkeyMarker">D</span>isplay:</header>
						<label><input type="radio" name="display" value="image"   class="input inputDisplay" checked="checked">Image</label>
						<label><input type="radio" name="display" value="heatmap" class="input inputDisplay"                  >Heatmap</label>
					</fieldset>
				</form>
				<div id="imageData"><span></span></div>
			</div>
			<div id="viewer">
				<div id="viewerImageContainer"><span></span></div>
			</div>
		</div>
		<script>
var reportData = {"name":"wuerth-red-issue-13879666","date":1533544021681,"configuration":{"widths":[576],"subSampleQualities":["full","half","quarter"],"qualities":[100,95,90,85,80,75,70,65,60,55,50,45],"perceptualQualities":["high","mediumHigh","medium","mediumLow","low"],"scenarios":["generic","chrome"]},"images":{"https://showserver.herokuapp.com/images/13879666/13879666_orig.jpg":{"baseName":"https___showserver.herokuapp.com_images_13879666_13879666_orig.jpg","pristineFormat":"jpg","pristineSize":1307511,"pristineEstimatedQuality":"Image Converter 100, Image Manager 100, JPEGTurbo 100, MozJPEG 100","derivatives":{"576":{"full":{"static_100":{"generic":{"format":"jpg","size":92972,"quality":100,"dssim":0.00029233283108892616,"ndssim":0.000473748307358246},"chrome":{"format":"jpg","size":92972,"quality":100,"dssim":0.00029233283108892616,"ndssim":0.000473748307358246}},"static_95":{"generic":{"format":"jpg","size":55403,"quality":95,"dssim":0.0012353878184602762,"ndssim":0.0029660638730478195},"chrome":{"format":"jpg","size":55403,"quality":95,"dssim":0.0012353878184602762,"ndssim":0.0029660638730478195}},"static_90":{"generic":{"format":"jpg","size":41006,"quality":90,"dssim":0.0019030383674688012,"ndssim":0.004995288085269611},"chrome":{"format":"jpg","size":41006,"quality":90,"dssim":0.0019030383674688012,"ndssim":0.004995288085269611}},"static_85":{"generic":{"format":"jpg","size":35916,"quality":85,"dssim":0.00248741819868209,"ndssim":0.006994873079997466},"chrome":{"format":"jpg","size":35916,"quality":85,"dssim":0.00248741819868209,"ndssim":0.006994873079997466}},"static_80":{"generic":{"format":"jpg","size":27577,"quality":80,"dssim":0.0035847754427519307,"ndssim":0.01091857501856519},"chrome":{"format":"jpg","size":27577,"quality":80,"dssim":0.0035847754427519307,"ndssim":0.01091857501856519}},"static_75":{"generic":{"format":"jpg","size":23149,"quality":75,"dssim":0.004612381154682821,"ndssim":0.014700617462637344},"chrome":{"format":"jpg","size":23149,"quality":75,"dssim":0.004612381154682821,"ndssim":0.014700617462637344}},"static_70":{"generic":{"format":"jpg","size":19891,"quality":70,"dssim":0.0056746770380953215,"ndssim":0.01878296222560899},"chrome":{"format":"jpg","size":19891,"quality":70,"dssim":0.0056746770380953215,"ndssim":0.01878296222560899}},"static_65":{"generic":{"format":"jpg","size":18038,"quality":65,"dssim":0.006429275181469629,"ndssim":0.021639394113032784},"chrome":{"format":"jpg","size":18038,"quality":65,"dssim":0.006429275181469629,"ndssim":0.021639394113032784}},"static_60":{"generic":{"format":"jpg","size":16441,"quality":60,"dssim":0.007123207196765402,"ndssim":0.024235317180910987},"chrome":{"format":"jpg","size":16441,"quality":60,"dssim":0.007123207196765402,"ndssim":0.024235317180910987}},"static_55":{"generic":{"format":"jpg","size":15797,"quality":55,"dssim":0.007562823679670427,"ndssim":0.025779913057090598},"chrome":{"format":"jpg","size":15797,"quality":55,"dssim":0.007562823679670427,"ndssim":0.025779913057090598}},"static_50":{"generic":{"format":"jpg","size":15127,"quality":50,"dssim":0.008019804841706557,"ndssim":0.02756378314454644},"chrome":{"format":"jpg","size":15127,"quality":50,"dssim":0.008019804841706557,"ndssim":0.02756378314454644}},"static_45":{"generic":{"format":"jpg","size":14664,"quality":45,"dssim":0.008364437709121986,"ndssim":0.028972371063392233},"chrome":{"format":"jpg","size":14664,"quality":45,"dssim":0.008364437709121986,"ndssim":0.028972371063392233}},"perceptual_high":{"generic":{"format":"jpg","size":32685,"quality":84,"dssim":0.00273503366806388,"ndssim":0.007833198204773462},"chrome":{"format":"jpg","size":32685,"quality":84,"dssim":0.00273503366806388,"ndssim":0.007833198204773462}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":25879,"quality":78,"dssim":0.003990030278617718,"ndssim":0.012377454245768083},"chrome":{"format":"jpg","size":25879,"quality":78,"dssim":0.003990030278617718,"ndssim":0.012377454245768083}},"perceptual_medium":{"generic":{"format":"jpg","size":14797,"quality":46,"dssim":0.008191651748572337,"ndssim":0.028202634512014546},"chrome":{"format":"jpg","size":14797,"quality":46,"dssim":0.008191651748572337,"ndssim":0.028202634512014546}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":12501,"quality":25,"dssim":0.010146766441912314,"ndssim":0.03540132906983684},"chrome":{"format":"jpg","size":12501,"quality":25,"dssim":0.010146766441912314,"ndssim":0.03540132906983684}},"perceptual_low":{"generic":{"format":"jpg","size":9892,"quality":5,"dssim":0.01360268842391732,"ndssim":0.04753558513015882},"chrome":{"format":"jpg","size":9892,"quality":5,"dssim":0.01360268842391732,"ndssim":0.04753558513015882}}},"half":{"static_100":{"generic":{"format":"jpg","size":75484,"quality":100,"dssim":0.00036918894158904925,"ndssim":0.0006646721538784983},"chrome":{"format":"jpg","size":75484,"quality":100,"dssim":0.00036918894158904925,"ndssim":0.0006646721538784983}},"static_95":{"generic":{"format":"jpg","size":46245,"quality":95,"dssim":0.0012807124175769347,"ndssim":0.003094748804783165},"chrome":{"format":"jpg","size":46245,"quality":95,"dssim":0.0012807124175769347,"ndssim":0.003094748804783165}},"static_90":{"generic":{"format":"jpg","size":35067,"quality":90,"dssim":0.0019454451726625965,"ndssim":0.005110904785161963},"chrome":{"format":"jpg","size":35067,"quality":90,"dssim":0.0019454451726625965,"ndssim":0.005110904785161963}},"static_85":{"generic":{"format":"jpg","size":30882,"quality":85,"dssim":0.002531521240418888,"ndssim":0.007118723754962253},"chrome":{"format":"jpg","size":30882,"quality":85,"dssim":0.002531521240418888,"ndssim":0.007118723754962253}},"static_80":{"generic":{"format":"jpg","size":24125,"quality":80,"dssim":0.0036415792076437414,"ndssim":0.011083941909885708},"chrome":{"format":"jpg","size":24125,"quality":80,"dssim":0.0036415792076437414,"ndssim":0.011083941909885708}},"static_75":{"generic":{"format":"jpg","size":20323,"quality":75,"dssim":0.004661404603806929,"ndssim":0.014844162904351199},"chrome":{"format":"jpg","size":20323,"quality":75,"dssim":0.004661404603806929,"ndssim":0.014844162904351199}},"static_70":{"generic":{"format":"jpg","size":17534,"quality":70,"dssim":0.005725548493770771,"ndssim":0.018910081327823403},"chrome":{"format":"jpg","size":17534,"quality":70,"dssim":0.005725548493770771,"ndssim":0.018910081327823403}},"static_65":{"generic":{"format":"jpg","size":15941,"quality":65,"dssim":0.0064504214142177,"ndssim":0.021681567833065574},"chrome":{"format":"jpg","size":15941,"quality":65,"dssim":0.0064504214142177,"ndssim":0.021681567833065574}},"static_60":{"generic":{"format":"jpg","size":14599,"quality":60,"dssim":0.0071577230711104,"ndssim":0.024311391035878538},"chrome":{"format":"jpg","size":14599,"quality":60,"dssim":0.0071577230711104,"ndssim":0.024311391035878538}},"static_55":{"generic":{"format":"jpg","size":14060,"quality":55,"dssim":0.007611949484900238,"ndssim":0.025883793371292707},"chrome":{"format":"jpg","size":14060,"quality":55,"dssim":0.007611949484900238,"ndssim":0.025883793371292707}},"static_50":{"generic":{"format":"jpg","size":13476,"quality":50,"dssim":0.008056085721397765,"ndssim":0.027684968498430218},"chrome":{"format":"jpg","size":13476,"quality":50,"dssim":0.008056085721397765,"ndssim":0.027684968498430218}},"static_45":{"generic":{"format":"jpg","size":13047,"quality":45,"dssim":0.008397840945016721,"ndssim":0.02906929628531313},"chrome":{"format":"jpg","size":13047,"quality":45,"dssim":0.008397840945016721,"ndssim":0.02906929628531313}},"perceptual_high":{"generic":{"format":"jpg","size":28367,"quality":84,"dssim":0.0027835778710590398,"ndssim":0.007976123013155922},"chrome":{"format":"jpg","size":28367,"quality":84,"dssim":0.0027835778710590398,"ndssim":0.007976123013155922}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":22666,"quality":78,"dssim":0.004044698778738254,"ndssim":0.012539112398121166},"chrome":{"format":"jpg","size":22666,"quality":78,"dssim":0.004044698778738254,"ndssim":0.012539112398121166}},"perceptual_medium":{"generic":{"format":"jpg","size":13287,"quality":49,"dssim":0.008162226784114879,"ndssim":0.028088935244664937},"chrome":{"format":"jpg","size":13287,"quality":49,"dssim":0.008162226784114879,"ndssim":0.028088935244664937}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":11149,"quality":25,"dssim":0.010214511483669142,"ndssim":0.03557379078405831},"chrome":{"format":"jpg","size":11149,"quality":25,"dssim":0.010214511483669142,"ndssim":0.03557379078405831}},"perceptual_low":{"generic":{"format":"jpg","size":8779,"quality":5,"dssim":0.013665752933315012,"ndssim":0.04772214709466516},"chrome":{"format":"jpg","size":8779,"quality":5,"dssim":0.013665752933315012,"ndssim":0.04772214709466516}}},"quarter":{"static_100":{"generic":{"format":"jpg","size":64552,"quality":100,"dssim":0.0003645014854825046,"ndssim":0.0006815291132258317},"chrome":{"format":"webp","size":35506,"quality":100,"dssim":0.0010801711918989043,"ndssim":0.0022682488054722727}},"static_95":{"generic":{"format":"jpg","size":40533,"quality":95,"dssim":0.0012942164431018477,"ndssim":0.003150771920312101},"chrome":{"format":"webp","size":29452,"quality":95,"dssim":0.001473432168293376,"ndssim":0.0031915599805699135}},"static_90":{"generic":{"format":"jpg","size":31243,"quality":90,"dssim":0.0019593061656507094,"ndssim":0.0051678092783953855},"chrome":{"format":"webp","size":21800,"quality":90,"dssim":0.002063614394164359,"ndssim":0.004642058293324647}},"static_85":{"generic":{"format":"jpg","size":27457,"quality":85,"dssim":0.0025438575440928646,"ndssim":0.007176742022592553},"chrome":{"format":"webp","size":17848,"quality":85,"dssim":0.0026750121005871264,"ndssim":0.006181850654038756}},"static_80":{"generic":{"format":"jpg","size":21642,"quality":80,"dssim":0.0036549666504099854,"ndssim":0.011127441326090948},"chrome":{"format":"webp","size":13972,"quality":80,"dssim":0.00342644503518702,"ndssim":0.008162033011976155}},"static_75":{"generic":{"format":"jpg","size":18246,"quality":75,"dssim":0.0046864682627068555,"ndssim":0.014919117244367175},"chrome":{"format":"webp","size":11236,"quality":75,"dssim":0.0043889351459873716,"ndssim":0.010987326993334101}},"static_70":{"generic":{"format":"jpg","size":15786,"quality":70,"dssim":0.005755505516760795,"ndssim":0.01900201358153758},"chrome":{"format":"webp","size":9292,"quality":70,"dssim":0.005336067417329671,"ndssim":0.01383668679018013}},"static_65":{"generic":{"format":"jpg","size":14350,"quality":65,"dssim":0.006476804191208163,"ndssim":0.02175414634785927},"chrome":{"format":"webp","size":8726,"quality":65,"dssim":0.005811029559728564,"ndssim":0.01530730402777103}},"static_60":{"generic":{"format":"jpg","size":13165,"quality":60,"dssim":0.00718457689175539,"ndssim":0.024400781076121536},"chrome":{"format":"webp","size":8338,"quality":60,"dssim":0.006137212360853406,"ndssim":0.016276536099603722}},"static_55":{"generic":{"format":"jpg","size":12693,"quality":55,"dssim":0.007626569753438728,"ndssim":0.025929451516642665},"chrome":{"format":"webp","size":7802,"quality":55,"dssim":0.006676307907099832,"ndssim":0.01794410463452145}},"static_50":{"generic":{"format":"jpg","size":12166,"quality":50,"dssim":0.008078084080571646,"ndssim":0.027736091381917904},"chrome":{"format":"webp","size":7514,"quality":50,"dssim":0.00694490258629904,"ndssim":0.018900187255052492}},"static_45":{"generic":{"format":"jpg","size":11774,"quality":45,"dssim":0.008419199223512641,"ndssim":0.029135346278052143},"chrome":{"format":"webp","size":6868,"quality":45,"dssim":0.007832119935222703,"ndssim":0.02179545176315245}},"perceptual_high":{"generic":{"format":"jpg","size":25403,"quality":84,"dssim":0.0027997069323814627,"ndssim":0.008033830588253466},"chrome":{"format":"webp","size":13972,"quality":81,"dssim":0.00342644503518702,"ndssim":0.008162033011976155}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":20279,"quality":78,"dssim":0.004064745126262648,"ndssim":0.012608436088183239},"chrome":{"format":"webp","size":10964,"quality":75,"dssim":0.004444467920194151,"ndssim":0.011197595754578626}},"perceptual_medium":{"generic":{"format":"jpg","size":11995,"quality":49,"dssim":0.00818640879421123,"ndssim":0.028164571649154924},"chrome":{"format":"webp","size":6772,"quality":44,"dssim":0.00797969817178884,"ndssim":0.02226819176095196}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":10045,"quality":25,"dssim":0.010210352845239912,"ndssim":0.035581012324016725},"chrome":{"format":"webp","size":5576,"quality":25,"dssim":0.010059649040035035,"ndssim":0.029433976863520894}},"perceptual_low":{"generic":{"format":"jpg","size":7899,"quality":5,"dssim":0.013690077342076112,"ndssim":0.04782986983185006},"chrome":{"format":"webp","size":4912,"quality":5,"dssim":0.011550360798616044,"ndssim":0.034505454362838306}}}}}}}};

function zeroPad(width, value) {
	var valueString = "" + value;
	var pad         = "0".repeat(width);
	return pad.substring(0, width - valueString.length) + valueString;
}

function fancyBytes(bytes) {
	var prefixes = ["  ","Ki","Mi","Gi","Ti","Pi","Ei"];
	var value    = parseInt(bytes);

	for (var prefix = 0; value >= 1023.995 && prefix < prefixes.length - 1; ++prefix) value /= 1024;

	if (0 !== prefix) value = value.toFixed(2);
	return value + " " + prefixes[prefix] + "B";
}

function getScenarioString(scenario) {
	switch (scenario) {
		case "generic": return "Generic";
		case "chrome" : return "Chrome" ;
		case "safari" : return "Safari" ;
		case "ie"     : return "IE/Edge";
	}
	return scenario;
}

function getPerceptualQualityString(perceptualQuality) {
	switch (perceptualQuality) {
		case "high":       return "High"       ;
		case "mediumHigh": return "Medium High";
		case "medium":     return "Medium"     ;
		case "mediumLow":  return "Medium Low" ;
		case "low":        return "Low"        ;
	}
	return perceptualQuality;
}

function getSubsamplingString(subsampling) {
	switch (subsampling) {
		case "full":    return "Full";
		case "half":    return "Half";
		case "quarter": return "Quarter";
	}
	return subsampling;
}

var pixelRatio = " " + window.devicePixelRatio + "x";

// Load Controls
{
	// Title
	document.title = document.title + ": " + reportData["name"];
	document.getElementById("mainTitle").appendChild(document.createTextNode(": " + reportData["name"]));
}
{
	// Images
	let imageFieldset = document.getElementById("imageControls");
	let imageSelect   = document.getElementById("imageName"    );
	let firstImage    = true;
	for (let imageName in reportData["images"]) {
		let imageOption = document.createElement("option");
		imageOption.value = imageName;
		imageOption.appendChild(document.createTextNode(imageName));
		imageSelect.appendChild(imageOption);
		if (firstImage) imageOption.selected = true;
		firstImage = false;
	}
	if (Object.keys(reportData["images"]).length <= 1) {
		imageFieldset.style.display = "none";
	}
}
{
	// Scenario
	let scenariosFieldset = document.getElementById("scenarioControls");
	let firstScenario     = true;
	for (let scenario of reportData["configuration"]["scenarios"]) {
		let scenarioLabel     = document.createElement("label");
		let scenarioInput     = document.createElement("input");
		let scenarioLabelText = document.createTextNode(getScenarioString(scenario));

		scenarioInput.type      = "radio";
		scenarioInput.name      = "scenario";
		scenarioInput.value     = scenario;
		scenarioInput.className = "input inputScenario";

		scenarioLabel.appendChild(scenarioInput);
		scenarioLabel.appendChild(scenarioLabelText);

		scenariosFieldset.appendChild(scenarioLabel);

		if (firstScenario) scenarioInput.checked = true;
		firstScenario = false;
	}
	if (reportData["configuration"]["scenarios"].length <= 1) {
		scenariosFieldset.style.display = "none";
	}
}
{
	// Breakpoints
	let breakpointFieldset = document.getElementById("breakpointControls");
	let firstBreakpoint    = true;
	for (let breakpoint of reportData["configuration"]["widths"]) {
		let breakpointLabel     = document.createElement("label");
		let breakpointInput     = document.createElement("input");
		let breakpointLabelText = document.createTextNode(breakpoint);

		breakpointInput.type      = "radio";
		breakpointInput.name      = "breakpoint";
		breakpointInput.value     = breakpoint;
		breakpointInput.className = "input inputBreakpoint";

		breakpointLabel.appendChild(breakpointInput);
		breakpointLabel.appendChild(breakpointLabelText);

		breakpointFieldset.appendChild(breakpointLabel);

		if (firstBreakpoint) breakpointInput.checked = true;
		firstBreakpoint = false;
	}
	if (reportData["configuration"]["widths"].length == 1 && reportData["configuration"]["widths"][0] == 5000) {
		breakpointFieldset.style.display = "none";
	}
}
{
	// SubSampling
	let subSamplingFieldset = document.getElementById("subSamplingControls");
	let firstSubSampling    = true;
	for (let subSampling of reportData["configuration"]["subSampleQualities"]) {
		let subSamplingLabel     = document.createElement("label");
		let subSamplingInput     = document.createElement("input");
		let subSamplingLabelText = document.createTextNode(getSubsamplingString(subSampling));

		subSamplingInput.type      = "radio";
		subSamplingInput.name      = "subSampling";
		subSamplingInput.value     = subSampling;
		subSamplingInput.className = "input inputSubSampling";

		subSamplingLabel.appendChild(subSamplingInput);
		subSamplingLabel.appendChild(subSamplingLabelText);

		subSamplingFieldset.appendChild(subSamplingLabel);

		if (firstSubSampling) subSamplingInput.checked = true;
		firstSubSampling = false;
	}
	if (reportData["configuration"]["subSampleQualities"].length <= 1) {
		subSamplingFieldset.style.display = "none";
	}
}
{
	// Static Quality
	let staticQualityFieldset = document.getElementById("staticQualityControls");

	let rawQualityLabel     = document.createElement("label");
	let rawQualityInput     = document.createElement("input");
	let rawQualityLabelText = document.createTextNode("Raw");

	rawQualityInput.type      = "radio";
	rawQualityInput.name      = "quality";
	rawQualityInput.value     = "raw";
	rawQualityInput.className = "input inputQuality";

	rawQualityLabel.appendChild(rawQualityInput);
	rawQualityLabel.appendChild(rawQualityLabelText);

	staticQualityFieldset.appendChild(rawQualityLabel);

	let firstStaticQuality = true;
	for (let staticQuality of reportData["configuration"]["qualities"]) {
		let staticQualityLabel     = document.createElement("label");
		let staticQualityInput     = document.createElement("input");
		let staticQualityLabelText = document.createTextNode(staticQuality);

		staticQualityInput.type      = "radio";
		staticQualityInput.name      = "quality";
		staticQualityInput.value     = "static_" + staticQuality;
		staticQualityInput.className = "input inputQuality";

		staticQualityLabel.appendChild(staticQualityInput);
		staticQualityLabel.appendChild(staticQualityLabelText);

		staticQualityFieldset.appendChild(staticQualityLabel);

		if (firstStaticQuality) staticQualityInput.checked = true;
		firstStaticQuality = false;
	}
}
{
	// Perceptual Quality
	let perceptualQualityFieldset = document.getElementById("perceptualQualityControls");
	let firstPerceptualQuality = true;
	for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
		let perceptualQualityLabel     = document.createElement("label");
		let perceptualQualityInput     = document.createElement("input");
		let perceptualQualityLabelText = document.createTextNode(getPerceptualQualityString(perceptualQuality));

		perceptualQualityInput.type      = "radio";
		perceptualQualityInput.name      = "quality";
		perceptualQualityInput.value     = "perceptual_" + perceptualQuality;
		perceptualQualityInput.className = "input inputQuality";

		perceptualQualityLabel.appendChild(perceptualQualityInput);
		perceptualQualityLabel.appendChild(perceptualQualityLabelText);

		perceptualQualityFieldset.appendChild(perceptualQualityLabel);

		if (firstPerceptualQuality) perceptualQualityInput.checked = true;
		firstPerceptualQuality = false;
	}
	if (reportData["configuration"]["perceptualQualities"].length <= 1) {
		perceptualQualityFieldset.style.display = "none";
	}
}


// Load Images
var derivativeImagesBasePath = "images/akamai";
var viewerImages = {};
// Image
for (let imageName in reportData["images"]) {
	let currentImageSet  = viewerImages[imageName] = {};
	let currentImageData = reportData["images"][imageName];
	let imageBaseName    = currentImageData["baseName"];

	// Widths
	for (let width of reportData["configuration"]["widths"]) {
		let currentWidthSet  = currentImageSet[width] = {};
		let currentWidthPath = derivativeImagesBasePath + "/w_" + zeroPad(4, width);

		// Raw Resize
		let rawResizeImage           = new Image();
		let rawResizePath            = currentWidthPath + "/rawResizes/" + imageBaseName + ".png";
		rawResizeImage.src           = rawResizePath;
		rawResizeImage.srcset        = rawResizePath + pixelRatio;
		currentWidthSet["rawResize"] = rawResizeImage;

		// Derivatives
		let currentDerivativesSet  = currentWidthSet["derivatives"] = {};
		let currentDerivativesData = currentImageData["derivatives"]["" + width];
		let currentDerivativesPath = currentWidthPath + "/derivatives";
		for (let subSampling of reportData["configuration"]["subSampleQualities"]) {
			let currentSubSampleSet  = currentDerivativesSet[subSampling] = {};
			let currentSubSampleData = currentDerivativesData[subSampling];
			let currentSubSamplePath = currentDerivativesPath + "/ss_" + subSampling;

			// Static quality
			for (let staticQuality of reportData["configuration"]["qualities"]) {
				let currentStaticQualitySet  = currentSubSampleSet["static_" + staticQuality] = {};
				let currentStaticQualityData = currentSubSampleData["static_" + staticQuality];
				let currentStaticQualityPath = currentSubSamplePath + "/q_static_" + zeroPad(3, staticQuality);

				// Scenario
				for (let scenario of reportData["configuration"]["scenarios"]) {
					let currentScenarioData = currentStaticQualityData[scenario];
					let currentScenarioPath = currentStaticQualityPath + "/sc_" + scenario;

					let derivativeImage     = new Image();
					let derivativeImagePath = currentScenarioPath + "/images/" + imageBaseName + "." + currentScenarioData["format"];
					derivativeImage.src     = derivativeImagePath;
					derivativeImage.srcset  = derivativeImagePath + pixelRatio;

					let heatmapImage     = new Image();
					let heatmapImagePath = currentScenarioPath + "/heatmaps/" + imageBaseName + ".jpg";
					heatmapImage.src     = heatmapImagePath;
					heatmapImage.srcset  = heatmapImagePath + pixelRatio;

					currentStaticQualitySet[scenario] = {};
					currentStaticQualitySet[scenario]["image"  ] = derivativeImage;
					currentStaticQualitySet[scenario]["heatmap"] = heatmapImage   ;
				}
			}

			// Perceptual quality
			for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
				let currentPerceptualQualitySet  = currentSubSampleSet["perceptual_" + perceptualQuality] = {};
				let currentPerceptualQualityData = currentSubSampleData["perceptual_" + perceptualQuality];
				let currentPerceptualQualityPath = currentSubSamplePath + "/q_perceptual_" + perceptualQuality;

				// Scenario
				for (let scenario of reportData["configuration"]["scenarios"]) {
					let currentScenarioData = currentPerceptualQualityData[scenario];
					let currentScenarioPath = currentPerceptualQualityPath + "/sc_" + scenario;

					let derivativeImage     = new Image();
					let derivativeImagePath = currentScenarioPath + "/images/" + imageBaseName + "." + currentScenarioData["format"];
					derivativeImage.src     = derivativeImagePath;
					derivativeImage.srcset  = derivativeImagePath + pixelRatio;

					let heatmapImage     = new Image();
					let heatmapImagePath = currentScenarioPath + "/heatmaps/" + imageBaseName + ".jpg";
					heatmapImage.src     = heatmapImagePath;
					heatmapImage.srcset  = heatmapImagePath + pixelRatio;

					currentPerceptualQualitySet[scenario] = {};
					currentPerceptualQualitySet[scenario]["image"  ] = derivativeImage;
					currentPerceptualQualitySet[scenario]["heatmap"] = heatmapImage   ;
				}
			}

		}
	}
}

var imageNameElement    = document.getElementById        ("imageName"       );
var scenarioElements    = document.getElementsByClassName("inputScenario"   );
var breakpointElements  = document.getElementsByClassName("inputBreakpoint" );
var subsamplingElements = document.getElementsByClassName("inputSubSampling");
var qualityElements     = document.getElementsByClassName("inputQuality"    );
var displayElements     = document.getElementsByClassName("inputDisplay"    );

var showViewerImage = function() {
	let imageName;
	let scenario;
	let breakpoint;
	let subsampling;
	let quality;
	let display;

	imageName = imageNameElement.value;
	Array.from(scenarioElements).forEach(function(element) {
		if (element.checked) scenario = element.value;
	});
	Array.from(breakpointElements).forEach(function(element) {
		if (element.checked) breakpoint = element.value;
	});
	Array.from(subsamplingElements).forEach(function(element) {
		if (element.checked) subsampling = element.value;
	});
	Array.from(qualityElements).forEach(function(element) {
		if (element.checked) quality = element.value;
	});
	Array.from(displayElements).forEach(function(element) {
		if (element.checked) display = element.value;
	});

	// Show Image
	let selectedImage;
	if ("raw" == quality) {
		selectedImage = viewerImages[imageName][breakpoint]["rawResize"];
	} else {
		selectedImage = viewerImages[imageName][breakpoint]["derivatives"][subsampling][quality][scenario][display];
	}

	let viewerImageContainer = document.getElementById("viewerImageContainer");
	if (undefined !== selectedImage) {
		viewerImageContainer.replaceChild(selectedImage, viewerImageContainer.childNodes[0]);
	}

	// Show Data
	let dataTable              = document.createElement("table");

	let dataTableHeaderRow     = document.createElement("tr");
	let dataTableQualityHeader = document.createElement("th");
	let dataTableFormatHeader  = document.createElement("th");
	let dataTableSizeHeader    = document.createElement("th");
	let dataTableNdssimHeader  = document.createElement("th");
	let dataTableDssimHeader   = document.createElement("th");

	dataTableQualityHeader.appendChild(document.createTextNode("Quality"));
	dataTableFormatHeader .appendChild(document.createTextNode("Format" ));
	dataTableSizeHeader   .appendChild(document.createTextNode("Size"   ));
	dataTableNdssimHeader .appendChild(document.createTextNode("NDSSIM" ));
	dataTableDssimHeader  .appendChild(document.createTextNode("DSSIM"  ));

	dataTableHeaderRow.appendChild(dataTableQualityHeader);
	dataTableHeaderRow.appendChild(dataTableFormatHeader );
	dataTableHeaderRow.appendChild(dataTableSizeHeader   );
	dataTableHeaderRow.appendChild(dataTableNdssimHeader );
	dataTableHeaderRow.appendChild(dataTableDssimHeader  );

	dataTable.appendChild(dataTableHeaderRow);

	let imageData = reportData["images"][imageName];

	let pristineRow = document.createElement("tr");

	let pristineQualityCell = document.createElement("td");
	let pristineFormatCell  = document.createElement("td");
	let pristineSizeCell    = document.createElement("td");
	let pristineNdssimCell  = document.createElement("td");
	let pristineDssimCell   = document.createElement("td");

	let pristineQualityData = document.createElement("span");
	pristineQualityData.classList.add("tooltipper");
	pristineQualityData.title = imageData.pristineEstimatedQuality;
	pristineQualityData.appendChild(document.createTextNode("Pristine"));

	pristineQualityCell.appendChild(pristineQualityData                                        );
	pristineFormatCell .appendChild(document.createTextNode(imageData.pristineFormat          ));
	pristineSizeCell   .appendChild(document.createTextNode(fancyBytes(imageData.pristineSize)));
	pristineNdssimCell .appendChild(document.createTextNode("N/A"                             ));
	pristineDssimCell  .appendChild(document.createTextNode("N/A"                             ));

	pristineRow.appendChild(pristineQualityCell);
	pristineRow.appendChild(pristineFormatCell );
	pristineRow.appendChild(pristineSizeCell   );
	pristineRow.appendChild(pristineNdssimCell );
	pristineRow.appendChild(pristineDssimCell  );

	dataTable.appendChild(pristineRow);

	for (let staticQuality of reportData["configuration"]["qualities"]) {
		let derivativeData = imageData["derivatives"][breakpoint][subsampling]["static_" + staticQuality][scenario];

		let dataRow     = document.createElement("tr");

		let qualityCell = document.createElement("td");
		let formatCell  = document.createElement("td");
		let sizeCell    = document.createElement("td");
		let ndssimCell  = document.createElement("td");
		let dssimCell   = document.createElement("td");

		qualityCell.appendChild(document.createTextNode(staticQuality                   ));
		formatCell .appendChild(document.createTextNode(derivativeData.format           ));
		sizeCell   .appendChild(document.createTextNode(fancyBytes(derivativeData.size) ));
		ndssimCell .appendChild(document.createTextNode(derivativeData.ndssim.toFixed(5)));
		dssimCell  .appendChild(document.createTextNode(derivativeData.dssim .toFixed(5)));

		dataRow.appendChild(qualityCell);
		dataRow.appendChild(formatCell );
		dataRow.appendChild(sizeCell   );
		dataRow.appendChild(ndssimCell );
		dataRow.appendChild(dssimCell  );

		dataTable.appendChild(dataRow);
	}
	for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
		let derivativeData = imageData["derivatives"][breakpoint][subsampling]["perceptual_" + perceptualQuality][scenario];

		let dataRow     = document.createElement("tr");

		let qualityCell = document.createElement("td");
		let formatCell  = document.createElement("td");
		let sizeCell    = document.createElement("td");
		let ndssimCell  = document.createElement("td");
		let dssimCell   = document.createElement("td");

		qualityCell.appendChild(document.createTextNode(getPerceptualQualityString(perceptualQuality) + ": " + derivativeData.quality));
		formatCell .appendChild(document.createTextNode(derivativeData.format                                                        ));
		sizeCell   .appendChild(document.createTextNode(fancyBytes(derivativeData.size)                                              ));
		ndssimCell .appendChild(document.createTextNode(derivativeData.ndssim.toFixed(5)                                             ));
		dssimCell  .appendChild(document.createTextNode(derivativeData.dssim .toFixed(5)                                             ));

		dataRow.appendChild(qualityCell);
		dataRow.appendChild(formatCell );
		dataRow.appendChild(sizeCell   );
		dataRow.appendChild(ndssimCell );
		dataRow.appendChild(dssimCell  );

		dataTable.appendChild(dataRow);
	}

	let imageDataContainer = document.getElementById("imageData");
	imageDataContainer.replaceChild(dataTable, imageDataContainer.childNodes[0]);
}

showViewerImage();

var inputElements = document.getElementsByClassName("input");
Array.from(inputElements).forEach(function(element) {
	element.onclick = showViewerImage;
});

document.addEventListener("keydown", function(e) {
	var selectedImageName;
	Array.from(imageNameElement.children).forEach(function(element) {
		if (element.selected) selectedImageName = element;
	})

	var scenarioArray = Array.from(scenarioElements);
	var scenarioIndex;
	for (scenarioIndex = 0; scenarioIndex < scenarioArray.length; ++scenarioIndex) {
		if (scenarioArray[scenarioIndex].checked) break;
	}

	var breakpointArray = Array.from(breakpointElements);
	var breakpointIndex;
	for (breakpointIndex = 0; breakpointIndex < breakpointArray.length; ++breakpointIndex) {
		if (breakpointArray[breakpointIndex].checked) break;
	}

	var subsamplingArray = Array.from(subsamplingElements);
	var subsamplingIndex;
	for (subsamplingIndex = 0; subsamplingIndex < subsamplingArray.length; ++subsamplingIndex) {
		if (subsamplingArray[subsamplingIndex].checked) break;
	}

	var qualityArray = Array.from(qualityElements);
	var qualityIndex;
	for (qualityIndex = 0; qualityIndex < qualityArray.length; ++qualityIndex) {
		if (qualityArray[qualityIndex].checked) break;
	}

	var displayArray = Array.from(displayElements);
	var displayIndex;
	for (displayIndex = 0; displayIndex < displayArray.length; ++displayIndex) {
		if (displayArray[displayIndex].checked) break;
	}

	switch (e.keyCode) {
		case  38: // up key
		case  40: // down key
			var toSelect = (e.keyCode == 38) ? selectedImageName.previousElementSibling : selectedImageName.nextElementSibling;
			if (null != toSelect) {
				toSelect.selected = true;
				showViewerImage();
			}
			e.preventDefault();
			break;
		case  83: // s key
			var newIndex = scenarioIndex + 1;
			var length = scenarioArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			scenarioArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case 189: // - key
		case 187: // = key
		case  66: // b key
			var newIndex = breakpointIndex + (e.keyCode == 187 ? -1 : 1);
			var length = breakpointArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			breakpointArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  67: // c key
			var newIndex = subsamplingIndex + 1;
			var length = subsamplingArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			subsamplingArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  68: // d key
			var newIndex = displayIndex + 1;
			var length = displayArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			displayArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  37: // left key
		case  39: // right key
		case  81: // q key
			var newIndex = qualityIndex + (e.keyCode == 37 ? -1 : 1);
			var length = qualityArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			qualityArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
	}
});
		</script>
	</body>
</html>