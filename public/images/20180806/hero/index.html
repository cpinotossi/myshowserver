<!doctype html>
<html>
	<head>
		<title>Akamai Image Comparison</title>
		<style>
body {
	margin:           auto;
	padding:          1em;
	font-family:      Helvetica, Sans-Serif;
	font-size:        12pt;
	background-color: #222;
	color:            #ddd;
}

h1 {
	margin-top: 0;
	font-size:  16pt;
}

#comparison {
	display: inline-block;
	margin:  auto;
	width:   auto;
}

#controls {
	width:            325pt;
	padding:          0.5em 0 0 0;
	text-align:       left;
	background-color: #444;
	float:            left;
}

#controls fieldset {
	margin:  0;
	border:  0;
	padding: 4pt 8pt;
}

#controls fieldset header {
	font-size:      12pt;
	font-weight:    bold;
	padding:        0;
	padding-bottom: 0.25em;
}

#controls fieldset fieldset {
	display: inline-block;
	padding: 4pt 10pt;
}

#controls fieldset fieldset header {
	font-weight: normal;
}

#controls label {
	display:      inline-block;
	margin-right: 1em;
}

#staticQualityControls label {
	min-width: 5em;
}

#perceptualQualityControls label {
	min-width: 8em;
}

#controls input {
	margin-right: 0.5em;
}

#imageName {
	max-width: 300pt;
}

#imageData {
	background-color: #333;
	padding:          4pt 8pt;
	font-size:        9pt;
	text-align:       left;
}

#imageData table {
	width: 100%;
	border-collapse: collapse;
}

#imageData table td, #imageData table th {
	text-align:    right;
	padding-right: 4pt;
	padding-left:  4pt;
}

#imageData table td {
	font-family: Monospace;
}

#viewer {
	margin-left: 325pt;
}

#viewerImageContainer {
	background-color: #666;
	background-image:
		linear-gradient( 45deg, #555 25%, transparent 25%),
		linear-gradient(-45deg, #555 25%, transparent 25%),
		linear-gradient( 45deg, transparent 75%, #555 75%),
		linear-gradient(-45deg, transparent 75%, #555 75%);
	background-size: 32pt 32pt;
	background-position: 0 0, 0pt 16pt, 16pt 16pt, 16pt 0pt;
}

#viewerImageContainer img {
	display: block;
	margin:  auto;
}

.hotkeyMarker {
	text-decoration: underline;
}

.tooltipper {
	-webkit-text-decoration: underline dashed;
	text-decoration:         underline dashed;
}

input[type=radio] {
	-webkit-appearance: none;
	appearance:         none;
	background-color:   #333;
	color:              #ddd;
	border:             0;
	border-radius:      50%;
	margin:             0 0.5em 0.25em 0;
	padding:            0;
	width:              1.5em;
	height:             1.5em;
	text-align:         center;
	vertical-align:     middle;
	font-size:          11pt;
}

input[type=radio]:checked {
	background-color: #222;
}

input[type=radio]:checked::after {
	display:          block;
	border:           0;
	border-radius:    50%;
	padding:          0;
	margin:           0.5em;
	width:            0.5em;
	height:           0.5em;
	background-color: #ddd;
	content:          " ";
}

		</style>
	</head>
	<body>
		<h1 id="mainTitle">Akamai Image Comparison</h1>
		<div id="comparison">
			<div id="controls">
				<form>
					<fieldset id="imageControls">
						<header>Image:</header>
						<select id="imageName" class="input">
						</select>
					</fieldset>
					<fieldset id="scenarioControls">
						<header><span class="hotkeyMarker">S</span>cenario:</header>
					</fieldset>
					<fieldset id="breakpointControls">
						<header><span class="hotkeyMarker">B</span>reakpoint:</header>
					</fieldset>
					<fieldset id="subSamplingControls">
						<header><span class="hotkeyMarker">C</span>hroma Subsampling Quality:</header>
					</fieldset>
					<fieldset id="qualityControls">
						<header><span class="hotkeyMarker">Q</span>uality:</header>
						<fieldset id="staticQualityControls">
							<header>Static:</header>
						</fieldset>
						<fieldset id="perceptualQualityControls">
							<header>Perceptual:</header>
						</fieldset>
					</fieldset>
					<fieldset id="displayControls">
						<header><span class="hotkeyMarker">D</span>isplay:</header>
						<label><input type="radio" name="display" value="image"   class="input inputDisplay" checked="checked">Image</label>
						<label><input type="radio" name="display" value="heatmap" class="input inputDisplay"                  >Heatmap</label>
					</fieldset>
				</form>
				<div id="imageData"><span></span></div>
			</div>
			<div id="viewer">
				<div id="viewerImageContainer"><span></span></div>
			</div>
		</div>
		<script>
var reportData = {"name":"wuerth-red-issue-hero","date":1533539529075,"configuration":{"widths":[876],"subSampleQualities":["full","half","quarter"],"qualities":[100,95,90,85,80,75,70,65,60,55,50,45],"perceptualQualities":["high","mediumHigh","medium","mediumLow","low"],"scenarios":["generic","chrome"]},"images":{"https://showserver.herokuapp.com/images/13879666/0818_freitagsschnapper_030818_876x430.png":{"baseName":"https___showserver.herokuapp.com_images_13879666_0818_freitagsschnapper_030818_876x430.png","pristineFormat":"png","pristineSize":101557,"pristineEstimatedQuality":"Lossless","derivatives":{"876":{"full":{"static_100":{"generic":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0}},"static_95":{"generic":{"format":"png","size":92025,"quality":95,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":95,"dssim":0.0,"ndssim":0.0}},"static_90":{"generic":{"format":"png","size":92025,"quality":90,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":90,"dssim":0.0,"ndssim":0.0}},"static_85":{"generic":{"format":"png","size":92025,"quality":85,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":85,"dssim":0.0,"ndssim":0.0}},"static_80":{"generic":{"format":"png","size":92025,"quality":80,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":80,"dssim":0.0,"ndssim":0.0}},"static_75":{"generic":{"format":"jpg","size":91549,"quality":75,"dssim":0.006494185561408183,"ndssim":0.007799779254646588},"chrome":{"format":"jpg","size":91549,"quality":75,"dssim":0.006494185561408183,"ndssim":0.007799779254646588}},"static_70":{"generic":{"format":"jpg","size":79582,"quality":70,"dssim":0.008417158407163394,"ndssim":0.010277710626943215},"chrome":{"format":"jpg","size":79582,"quality":70,"dssim":0.008417158407163394,"ndssim":0.010277710626943215}},"static_65":{"generic":{"format":"jpg","size":72055,"quality":65,"dssim":0.010214893852057039,"ndssim":0.012655314642605775},"chrome":{"format":"jpg","size":72055,"quality":65,"dssim":0.010214893852057039,"ndssim":0.012655314642605775}},"static_60":{"generic":{"format":"jpg","size":65962,"quality":60,"dssim":0.011902083357499593,"ndssim":0.01491111496548958},"chrome":{"format":"jpg","size":65962,"quality":60,"dssim":0.011902083357499593,"ndssim":0.01491111496548958}},"static_55":{"generic":{"format":"jpg","size":62699,"quality":55,"dssim":0.01279332146558465,"ndssim":0.016072650884950024},"chrome":{"format":"jpg","size":62699,"quality":55,"dssim":0.01279332146558465,"ndssim":0.016072650884950024}},"static_50":{"generic":{"format":"jpg","size":59918,"quality":50,"dssim":0.014113996679087304,"ndssim":0.017973625350526934},"chrome":{"format":"jpg","size":59918,"quality":50,"dssim":0.014113996679087304,"ndssim":0.017973625350526934}},"static_45":{"generic":{"format":"jpg","size":57663,"quality":45,"dssim":0.015237600748589708,"ndssim":0.01952205226608339},"chrome":{"format":"jpg","size":57663,"quality":45,"dssim":0.015237600748589708,"ndssim":0.01952205226608339}},"perceptual_high":{"generic":{"format":"jpg","size":91549,"quality":75,"dssim":0.006494185561408183,"ndssim":0.007799779254646588},"chrome":{"format":"jpg","size":91549,"quality":75,"dssim":0.006494185561408183,"ndssim":0.007799779254646588}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":74134,"quality":67,"dssim":0.00954519614218885,"ndssim":0.011729482528247404},"chrome":{"format":"jpg","size":74134,"quality":67,"dssim":0.00954519614218885,"ndssim":0.011729482528247404}},"perceptual_medium":{"generic":{"format":"jpg","size":57663,"quality":44,"dssim":0.015237600748589708,"ndssim":0.01952205226608339},"chrome":{"format":"jpg","size":57663,"quality":44,"dssim":0.015237600748589708,"ndssim":0.01952205226608339}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":48643,"quality":25,"dssim":0.01884083213187493,"ndssim":0.02420116113850551},"chrome":{"format":"jpg","size":48643,"quality":25,"dssim":0.01884083213187493,"ndssim":0.02420116113850551}},"perceptual_low":{"generic":{"format":"jpg","size":36507,"quality":5,"dssim":0.027766653886358628,"ndssim":0.03616508753587916},"chrome":{"format":"jpg","size":36507,"quality":5,"dssim":0.027766653886358628,"ndssim":0.03616508753587916}}},"half":{"static_100":{"generic":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0}},"static_95":{"generic":{"format":"png","size":92025,"quality":95,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":95,"dssim":0.0,"ndssim":0.0}},"static_90":{"generic":{"format":"png","size":92025,"quality":90,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":90,"dssim":0.0,"ndssim":0.0}},"static_85":{"generic":{"format":"png","size":92025,"quality":85,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":85,"dssim":0.0,"ndssim":0.0}},"static_80":{"generic":{"format":"jpg","size":91519,"quality":80,"dssim":0.004999842757874018,"ndssim":0.00595138547160784},"chrome":{"format":"jpg","size":91519,"quality":80,"dssim":0.004999842757874018,"ndssim":0.00595138547160784}},"static_75":{"generic":{"format":"jpg","size":77548,"quality":75,"dssim":0.006869731619170816,"ndssim":0.008365407029463923},"chrome":{"format":"jpg","size":77548,"quality":75,"dssim":0.006869731619170816,"ndssim":0.008365407029463923}},"static_70":{"generic":{"format":"jpg","size":67624,"quality":70,"dssim":0.008827833431248044,"ndssim":0.010897128554490876},"chrome":{"format":"jpg","size":67624,"quality":70,"dssim":0.008827833431248044,"ndssim":0.010897128554490876}},"static_65":{"generic":{"format":"jpg","size":61235,"quality":65,"dssim":0.01064181750636517,"ndssim":0.01329478019478808},"chrome":{"format":"jpg","size":61235,"quality":65,"dssim":0.01064181750636517,"ndssim":0.01329478019478808}},"static_60":{"generic":{"format":"jpg","size":56146,"quality":60,"dssim":0.012350541222284739,"ndssim":0.015579037499783288},"chrome":{"format":"jpg","size":56146,"quality":60,"dssim":0.012350541222284739,"ndssim":0.015579037499783288}},"static_55":{"generic":{"format":"jpg","size":53407,"quality":55,"dssim":0.01329979296877315,"ndssim":0.016836645658519778},"chrome":{"format":"jpg","size":53407,"quality":55,"dssim":0.01329979296877315,"ndssim":0.016836645658519778}},"static_50":{"generic":{"format":"jpg","size":51070,"quality":50,"dssim":0.014590542303398069,"ndssim":0.018686185027398994},"chrome":{"format":"jpg","size":51070,"quality":50,"dssim":0.014590542303398069,"ndssim":0.018686185027398994}},"static_45":{"generic":{"format":"jpg","size":49111,"quality":45,"dssim":0.015725886459839467,"ndssim":0.02024794328161733},"chrome":{"format":"jpg","size":49111,"quality":45,"dssim":0.015725886459839467,"ndssim":0.02024794328161733}},"perceptual_high":{"generic":{"format":"jpg","size":77548,"quality":75,"dssim":0.006869731619170816,"ndssim":0.008365407029463923},"chrome":{"format":"jpg","size":77548,"quality":75,"dssim":0.006869731619170816,"ndssim":0.008365407029463923}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":63005,"quality":67,"dssim":0.009961790404521553,"ndssim":0.01235549607353803},"chrome":{"format":"jpg","size":63005,"quality":67,"dssim":0.009961790404521553,"ndssim":0.01235549607353803}},"perceptual_medium":{"generic":{"format":"jpg","size":49111,"quality":44,"dssim":0.015725886459839467,"ndssim":0.02024794328161733},"chrome":{"format":"jpg","size":49111,"quality":44,"dssim":0.015725886459839467,"ndssim":0.02024794328161733}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":41491,"quality":25,"dssim":0.019441271069221944,"ndssim":0.025084637878321603},"chrome":{"format":"jpg","size":41491,"quality":25,"dssim":0.019441271069221944,"ndssim":0.025084637878321603}},"perceptual_low":{"generic":{"format":"jpg","size":31163,"quality":5,"dssim":0.028529166798531125,"ndssim":0.03725307329060479},"chrome":{"format":"jpg","size":31163,"quality":5,"dssim":0.028529166798531125,"ndssim":0.03725307329060479}}},"quarter":{"static_100":{"generic":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"png","size":92025,"quality":100,"dssim":0.0,"ndssim":0.0}},"static_95":{"generic":{"format":"png","size":92025,"quality":95,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"webp","size":91854,"quality":95,"dssim":0.002570014694377065,"ndssim":0.0031002150123927152}},"static_90":{"generic":{"format":"png","size":92025,"quality":90,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"webp","size":77454,"quality":90,"dssim":0.0031097961514729433,"ndssim":0.0035877584878488133}},"static_85":{"generic":{"format":"png","size":92025,"quality":85,"dssim":0.0,"ndssim":0.0},"chrome":{"format":"webp","size":68872,"quality":85,"dssim":0.0036296491875407733,"ndssim":0.004071761648409666}},"static_80":{"generic":{"format":"jpg","size":81759,"quality":80,"dssim":0.0053276294826341,"ndssim":0.006412724172731588},"chrome":{"format":"webp","size":58190,"quality":80,"dssim":0.004574659578063078,"ndssim":0.005013417485261518}},"static_75":{"generic":{"format":"jpg","size":69410,"quality":75,"dssim":0.007239808021450522,"ndssim":0.008882789814554759},"chrome":{"format":"webp","size":49170,"quality":75,"dssim":0.005856807754939075,"ndssim":0.006320109876264524}},"static_70":{"generic":{"format":"jpg","size":60594,"quality":70,"dssim":0.009199838925442183,"ndssim":0.011417392936321269},"chrome":{"format":"webp","size":42056,"quality":70,"dssim":0.007344213735323679,"ndssim":0.00789583822562484}},"static_65":{"generic":{"format":"jpg","size":54796,"quality":65,"dssim":0.011061680570578658,"ndssim":0.013884631237182588},"chrome":{"format":"webp","size":39996,"quality":65,"dssim":0.007890628643347386,"ndssim":0.008418276877965036}},"static_60":{"generic":{"format":"jpg","size":50332,"quality":60,"dssim":0.01281955685698738,"ndssim":0.016246188831644692},"chrome":{"format":"webp","size":37728,"quality":60,"dssim":0.008864462797144201,"ndssim":0.009547840660135865}},"static_55":{"generic":{"format":"jpg","size":47918,"quality":55,"dssim":0.01388903784930462,"ndssim":0.017647551034188524},"chrome":{"format":"webp","size":35658,"quality":55,"dssim":0.009625323033823685,"ndssim":0.010367759074568161}},"static_50":{"generic":{"format":"jpg","size":45863,"quality":50,"dssim":0.015095830620762474,"ndssim":0.019383811375390025},"chrome":{"format":"webp","size":33670,"quality":50,"dssim":0.010459282628703714,"ndssim":0.011244289522224393}},"static_45":{"generic":{"format":"jpg","size":44093,"quality":45,"dssim":0.01625465945790383,"ndssim":0.020976318787376436},"chrome":{"format":"webp","size":32244,"quality":45,"dssim":0.011116380330772113,"ndssim":0.011993598233245917}},"perceptual_high":{"generic":{"format":"jpg","size":69410,"quality":75,"dssim":0.007239808021450522,"ndssim":0.008882789814554759},"chrome":{"format":"webp","size":40618,"quality":67,"dssim":0.007686190080584798,"ndssim":0.008193811667964845}},"perceptual_mediumHigh":{"generic":{"format":"jpg","size":56418,"quality":67,"dssim":0.010348575015530492,"ndssim":0.01290166062618453},"chrome":{"format":"webp","size":34280,"quality":51,"dssim":0.010354897721152445,"ndssim":0.011073652083454177}},"perceptual_medium":{"generic":{"format":"jpg","size":44093,"quality":44,"dssim":0.01625465945790383,"ndssim":0.020976318787376436},"chrome":{"format":"webp","size":31968,"quality":44,"dssim":0.011204939925095914,"ndssim":0.012099840306280696}},"perceptual_mediumLow":{"generic":{"format":"jpg","size":37311,"quality":25,"dssim":0.020029486834708565,"ndssim":0.025888016351965137},"chrome":{"format":"webp","size":25342,"quality":25,"dssim":0.01593489758642641,"ndssim":0.017604187475311672}},"perceptual_low":{"generic":{"format":"jpg","size":28010,"quality":5,"dssim":0.0290516380448117,"ndssim":0.03794517692361382},"chrome":{"format":"webp","size":21696,"quality":5,"dssim":0.02014816421362703,"ndssim":0.022391081014618897}}}}}}}};

function zeroPad(width, value) {
	var valueString = "" + value;
	var pad         = "0".repeat(width);
	return pad.substring(0, width - valueString.length) + valueString;
}

function fancyBytes(bytes) {
	var prefixes = ["  ","Ki","Mi","Gi","Ti","Pi","Ei"];
	var value    = parseInt(bytes);

	for (var prefix = 0; value >= 1023.995 && prefix < prefixes.length - 1; ++prefix) value /= 1024;

	if (0 !== prefix) value = value.toFixed(2);
	return value + " " + prefixes[prefix] + "B";
}

function getScenarioString(scenario) {
	switch (scenario) {
		case "generic": return "Generic";
		case "chrome" : return "Chrome" ;
		case "safari" : return "Safari" ;
		case "ie"     : return "IE/Edge";
	}
	return scenario;
}

function getPerceptualQualityString(perceptualQuality) {
	switch (perceptualQuality) {
		case "high":       return "High"       ;
		case "mediumHigh": return "Medium High";
		case "medium":     return "Medium"     ;
		case "mediumLow":  return "Medium Low" ;
		case "low":        return "Low"        ;
	}
	return perceptualQuality;
}

function getSubsamplingString(subsampling) {
	switch (subsampling) {
		case "full":    return "Full";
		case "half":    return "Half";
		case "quarter": return "Quarter";
	}
	return subsampling;
}

var pixelRatio = " " + window.devicePixelRatio + "x";

// Load Controls
{
	// Title
	document.title = document.title + ": " + reportData["name"];
	document.getElementById("mainTitle").appendChild(document.createTextNode(": " + reportData["name"]));
}
{
	// Images
	let imageFieldset = document.getElementById("imageControls");
	let imageSelect   = document.getElementById("imageName"    );
	let firstImage    = true;
	for (let imageName in reportData["images"]) {
		let imageOption = document.createElement("option");
		imageOption.value = imageName;
		imageOption.appendChild(document.createTextNode(imageName));
		imageSelect.appendChild(imageOption);
		if (firstImage) imageOption.selected = true;
		firstImage = false;
	}
	if (Object.keys(reportData["images"]).length <= 1) {
		imageFieldset.style.display = "none";
	}
}
{
	// Scenario
	let scenariosFieldset = document.getElementById("scenarioControls");
	let firstScenario     = true;
	for (let scenario of reportData["configuration"]["scenarios"]) {
		let scenarioLabel     = document.createElement("label");
		let scenarioInput     = document.createElement("input");
		let scenarioLabelText = document.createTextNode(getScenarioString(scenario));

		scenarioInput.type      = "radio";
		scenarioInput.name      = "scenario";
		scenarioInput.value     = scenario;
		scenarioInput.className = "input inputScenario";

		scenarioLabel.appendChild(scenarioInput);
		scenarioLabel.appendChild(scenarioLabelText);

		scenariosFieldset.appendChild(scenarioLabel);

		if (firstScenario) scenarioInput.checked = true;
		firstScenario = false;
	}
	if (reportData["configuration"]["scenarios"].length <= 1) {
		scenariosFieldset.style.display = "none";
	}
}
{
	// Breakpoints
	let breakpointFieldset = document.getElementById("breakpointControls");
	let firstBreakpoint    = true;
	for (let breakpoint of reportData["configuration"]["widths"]) {
		let breakpointLabel     = document.createElement("label");
		let breakpointInput     = document.createElement("input");
		let breakpointLabelText = document.createTextNode(breakpoint);

		breakpointInput.type      = "radio";
		breakpointInput.name      = "breakpoint";
		breakpointInput.value     = breakpoint;
		breakpointInput.className = "input inputBreakpoint";

		breakpointLabel.appendChild(breakpointInput);
		breakpointLabel.appendChild(breakpointLabelText);

		breakpointFieldset.appendChild(breakpointLabel);

		if (firstBreakpoint) breakpointInput.checked = true;
		firstBreakpoint = false;
	}
	if (reportData["configuration"]["widths"].length == 1 && reportData["configuration"]["widths"][0] == 5000) {
		breakpointFieldset.style.display = "none";
	}
}
{
	// SubSampling
	let subSamplingFieldset = document.getElementById("subSamplingControls");
	let firstSubSampling    = true;
	for (let subSampling of reportData["configuration"]["subSampleQualities"]) {
		let subSamplingLabel     = document.createElement("label");
		let subSamplingInput     = document.createElement("input");
		let subSamplingLabelText = document.createTextNode(getSubsamplingString(subSampling));

		subSamplingInput.type      = "radio";
		subSamplingInput.name      = "subSampling";
		subSamplingInput.value     = subSampling;
		subSamplingInput.className = "input inputSubSampling";

		subSamplingLabel.appendChild(subSamplingInput);
		subSamplingLabel.appendChild(subSamplingLabelText);

		subSamplingFieldset.appendChild(subSamplingLabel);

		if (firstSubSampling) subSamplingInput.checked = true;
		firstSubSampling = false;
	}
	if (reportData["configuration"]["subSampleQualities"].length <= 1) {
		subSamplingFieldset.style.display = "none";
	}
}
{
	// Static Quality
	let staticQualityFieldset = document.getElementById("staticQualityControls");

	let rawQualityLabel     = document.createElement("label");
	let rawQualityInput     = document.createElement("input");
	let rawQualityLabelText = document.createTextNode("Raw");

	rawQualityInput.type      = "radio";
	rawQualityInput.name      = "quality";
	rawQualityInput.value     = "raw";
	rawQualityInput.className = "input inputQuality";

	rawQualityLabel.appendChild(rawQualityInput);
	rawQualityLabel.appendChild(rawQualityLabelText);

	staticQualityFieldset.appendChild(rawQualityLabel);

	let firstStaticQuality = true;
	for (let staticQuality of reportData["configuration"]["qualities"]) {
		let staticQualityLabel     = document.createElement("label");
		let staticQualityInput     = document.createElement("input");
		let staticQualityLabelText = document.createTextNode(staticQuality);

		staticQualityInput.type      = "radio";
		staticQualityInput.name      = "quality";
		staticQualityInput.value     = "static_" + staticQuality;
		staticQualityInput.className = "input inputQuality";

		staticQualityLabel.appendChild(staticQualityInput);
		staticQualityLabel.appendChild(staticQualityLabelText);

		staticQualityFieldset.appendChild(staticQualityLabel);

		if (firstStaticQuality) staticQualityInput.checked = true;
		firstStaticQuality = false;
	}
}
{
	// Perceptual Quality
	let perceptualQualityFieldset = document.getElementById("perceptualQualityControls");
	let firstPerceptualQuality = true;
	for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
		let perceptualQualityLabel     = document.createElement("label");
		let perceptualQualityInput     = document.createElement("input");
		let perceptualQualityLabelText = document.createTextNode(getPerceptualQualityString(perceptualQuality));

		perceptualQualityInput.type      = "radio";
		perceptualQualityInput.name      = "quality";
		perceptualQualityInput.value     = "perceptual_" + perceptualQuality;
		perceptualQualityInput.className = "input inputQuality";

		perceptualQualityLabel.appendChild(perceptualQualityInput);
		perceptualQualityLabel.appendChild(perceptualQualityLabelText);

		perceptualQualityFieldset.appendChild(perceptualQualityLabel);

		if (firstPerceptualQuality) perceptualQualityInput.checked = true;
		firstPerceptualQuality = false;
	}
	if (reportData["configuration"]["perceptualQualities"].length <= 1) {
		perceptualQualityFieldset.style.display = "none";
	}
}


// Load Images
var derivativeImagesBasePath = "images/akamai";
var viewerImages = {};
// Image
for (let imageName in reportData["images"]) {
	let currentImageSet  = viewerImages[imageName] = {};
	let currentImageData = reportData["images"][imageName];
	let imageBaseName    = currentImageData["baseName"];

	// Widths
	for (let width of reportData["configuration"]["widths"]) {
		let currentWidthSet  = currentImageSet[width] = {};
		let currentWidthPath = derivativeImagesBasePath + "/w_" + zeroPad(4, width);

		// Raw Resize
		let rawResizeImage           = new Image();
		let rawResizePath            = currentWidthPath + "/rawResizes/" + imageBaseName + ".png";
		rawResizeImage.src           = rawResizePath;
		rawResizeImage.srcset        = rawResizePath + pixelRatio;
		currentWidthSet["rawResize"] = rawResizeImage;

		// Derivatives
		let currentDerivativesSet  = currentWidthSet["derivatives"] = {};
		let currentDerivativesData = currentImageData["derivatives"]["" + width];
		let currentDerivativesPath = currentWidthPath + "/derivatives";
		for (let subSampling of reportData["configuration"]["subSampleQualities"]) {
			let currentSubSampleSet  = currentDerivativesSet[subSampling] = {};
			let currentSubSampleData = currentDerivativesData[subSampling];
			let currentSubSamplePath = currentDerivativesPath + "/ss_" + subSampling;

			// Static quality
			for (let staticQuality of reportData["configuration"]["qualities"]) {
				let currentStaticQualitySet  = currentSubSampleSet["static_" + staticQuality] = {};
				let currentStaticQualityData = currentSubSampleData["static_" + staticQuality];
				let currentStaticQualityPath = currentSubSamplePath + "/q_static_" + zeroPad(3, staticQuality);

				// Scenario
				for (let scenario of reportData["configuration"]["scenarios"]) {
					let currentScenarioData = currentStaticQualityData[scenario];
					let currentScenarioPath = currentStaticQualityPath + "/sc_" + scenario;

					let derivativeImage     = new Image();
					let derivativeImagePath = currentScenarioPath + "/images/" + imageBaseName + "." + currentScenarioData["format"];
					derivativeImage.src     = derivativeImagePath;
					derivativeImage.srcset  = derivativeImagePath + pixelRatio;

					let heatmapImage     = new Image();
					let heatmapImagePath = currentScenarioPath + "/heatmaps/" + imageBaseName + ".jpg";
					heatmapImage.src     = heatmapImagePath;
					heatmapImage.srcset  = heatmapImagePath + pixelRatio;

					currentStaticQualitySet[scenario] = {};
					currentStaticQualitySet[scenario]["image"  ] = derivativeImage;
					currentStaticQualitySet[scenario]["heatmap"] = heatmapImage   ;
				}
			}

			// Perceptual quality
			for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
				let currentPerceptualQualitySet  = currentSubSampleSet["perceptual_" + perceptualQuality] = {};
				let currentPerceptualQualityData = currentSubSampleData["perceptual_" + perceptualQuality];
				let currentPerceptualQualityPath = currentSubSamplePath + "/q_perceptual_" + perceptualQuality;

				// Scenario
				for (let scenario of reportData["configuration"]["scenarios"]) {
					let currentScenarioData = currentPerceptualQualityData[scenario];
					let currentScenarioPath = currentPerceptualQualityPath + "/sc_" + scenario;

					let derivativeImage     = new Image();
					let derivativeImagePath = currentScenarioPath + "/images/" + imageBaseName + "." + currentScenarioData["format"];
					derivativeImage.src     = derivativeImagePath;
					derivativeImage.srcset  = derivativeImagePath + pixelRatio;

					let heatmapImage     = new Image();
					let heatmapImagePath = currentScenarioPath + "/heatmaps/" + imageBaseName + ".jpg";
					heatmapImage.src     = heatmapImagePath;
					heatmapImage.srcset  = heatmapImagePath + pixelRatio;

					currentPerceptualQualitySet[scenario] = {};
					currentPerceptualQualitySet[scenario]["image"  ] = derivativeImage;
					currentPerceptualQualitySet[scenario]["heatmap"] = heatmapImage   ;
				}
			}

		}
	}
}

var imageNameElement    = document.getElementById        ("imageName"       );
var scenarioElements    = document.getElementsByClassName("inputScenario"   );
var breakpointElements  = document.getElementsByClassName("inputBreakpoint" );
var subsamplingElements = document.getElementsByClassName("inputSubSampling");
var qualityElements     = document.getElementsByClassName("inputQuality"    );
var displayElements     = document.getElementsByClassName("inputDisplay"    );

var showViewerImage = function() {
	let imageName;
	let scenario;
	let breakpoint;
	let subsampling;
	let quality;
	let display;

	imageName = imageNameElement.value;
	Array.from(scenarioElements).forEach(function(element) {
		if (element.checked) scenario = element.value;
	});
	Array.from(breakpointElements).forEach(function(element) {
		if (element.checked) breakpoint = element.value;
	});
	Array.from(subsamplingElements).forEach(function(element) {
		if (element.checked) subsampling = element.value;
	});
	Array.from(qualityElements).forEach(function(element) {
		if (element.checked) quality = element.value;
	});
	Array.from(displayElements).forEach(function(element) {
		if (element.checked) display = element.value;
	});

	// Show Image
	let selectedImage;
	if ("raw" == quality) {
		selectedImage = viewerImages[imageName][breakpoint]["rawResize"];
	} else {
		selectedImage = viewerImages[imageName][breakpoint]["derivatives"][subsampling][quality][scenario][display];
	}

	let viewerImageContainer = document.getElementById("viewerImageContainer");
	if (undefined !== selectedImage) {
		viewerImageContainer.replaceChild(selectedImage, viewerImageContainer.childNodes[0]);
	}

	// Show Data
	let dataTable              = document.createElement("table");

	let dataTableHeaderRow     = document.createElement("tr");
	let dataTableQualityHeader = document.createElement("th");
	let dataTableFormatHeader  = document.createElement("th");
	let dataTableSizeHeader    = document.createElement("th");
	let dataTableNdssimHeader  = document.createElement("th");
	let dataTableDssimHeader   = document.createElement("th");

	dataTableQualityHeader.appendChild(document.createTextNode("Quality"));
	dataTableFormatHeader .appendChild(document.createTextNode("Format" ));
	dataTableSizeHeader   .appendChild(document.createTextNode("Size"   ));
	dataTableNdssimHeader .appendChild(document.createTextNode("NDSSIM" ));
	dataTableDssimHeader  .appendChild(document.createTextNode("DSSIM"  ));

	dataTableHeaderRow.appendChild(dataTableQualityHeader);
	dataTableHeaderRow.appendChild(dataTableFormatHeader );
	dataTableHeaderRow.appendChild(dataTableSizeHeader   );
	dataTableHeaderRow.appendChild(dataTableNdssimHeader );
	dataTableHeaderRow.appendChild(dataTableDssimHeader  );

	dataTable.appendChild(dataTableHeaderRow);

	let imageData = reportData["images"][imageName];

	let pristineRow = document.createElement("tr");

	let pristineQualityCell = document.createElement("td");
	let pristineFormatCell  = document.createElement("td");
	let pristineSizeCell    = document.createElement("td");
	let pristineNdssimCell  = document.createElement("td");
	let pristineDssimCell   = document.createElement("td");

	let pristineQualityData = document.createElement("span");
	pristineQualityData.classList.add("tooltipper");
	pristineQualityData.title = imageData.pristineEstimatedQuality;
	pristineQualityData.appendChild(document.createTextNode("Pristine"));

	pristineQualityCell.appendChild(pristineQualityData                                        );
	pristineFormatCell .appendChild(document.createTextNode(imageData.pristineFormat          ));
	pristineSizeCell   .appendChild(document.createTextNode(fancyBytes(imageData.pristineSize)));
	pristineNdssimCell .appendChild(document.createTextNode("N/A"                             ));
	pristineDssimCell  .appendChild(document.createTextNode("N/A"                             ));

	pristineRow.appendChild(pristineQualityCell);
	pristineRow.appendChild(pristineFormatCell );
	pristineRow.appendChild(pristineSizeCell   );
	pristineRow.appendChild(pristineNdssimCell );
	pristineRow.appendChild(pristineDssimCell  );

	dataTable.appendChild(pristineRow);

	for (let staticQuality of reportData["configuration"]["qualities"]) {
		let derivativeData = imageData["derivatives"][breakpoint][subsampling]["static_" + staticQuality][scenario];

		let dataRow     = document.createElement("tr");

		let qualityCell = document.createElement("td");
		let formatCell  = document.createElement("td");
		let sizeCell    = document.createElement("td");
		let ndssimCell  = document.createElement("td");
		let dssimCell   = document.createElement("td");

		qualityCell.appendChild(document.createTextNode(staticQuality                   ));
		formatCell .appendChild(document.createTextNode(derivativeData.format           ));
		sizeCell   .appendChild(document.createTextNode(fancyBytes(derivativeData.size) ));
		ndssimCell .appendChild(document.createTextNode(derivativeData.ndssim.toFixed(5)));
		dssimCell  .appendChild(document.createTextNode(derivativeData.dssim .toFixed(5)));

		dataRow.appendChild(qualityCell);
		dataRow.appendChild(formatCell );
		dataRow.appendChild(sizeCell   );
		dataRow.appendChild(ndssimCell );
		dataRow.appendChild(dssimCell  );

		dataTable.appendChild(dataRow);
	}
	for (let perceptualQuality of reportData["configuration"]["perceptualQualities"]) {
		let derivativeData = imageData["derivatives"][breakpoint][subsampling]["perceptual_" + perceptualQuality][scenario];

		let dataRow     = document.createElement("tr");

		let qualityCell = document.createElement("td");
		let formatCell  = document.createElement("td");
		let sizeCell    = document.createElement("td");
		let ndssimCell  = document.createElement("td");
		let dssimCell   = document.createElement("td");

		qualityCell.appendChild(document.createTextNode(getPerceptualQualityString(perceptualQuality) + ": " + derivativeData.quality));
		formatCell .appendChild(document.createTextNode(derivativeData.format                                                        ));
		sizeCell   .appendChild(document.createTextNode(fancyBytes(derivativeData.size)                                              ));
		ndssimCell .appendChild(document.createTextNode(derivativeData.ndssim.toFixed(5)                                             ));
		dssimCell  .appendChild(document.createTextNode(derivativeData.dssim .toFixed(5)                                             ));

		dataRow.appendChild(qualityCell);
		dataRow.appendChild(formatCell );
		dataRow.appendChild(sizeCell   );
		dataRow.appendChild(ndssimCell );
		dataRow.appendChild(dssimCell  );

		dataTable.appendChild(dataRow);
	}

	let imageDataContainer = document.getElementById("imageData");
	imageDataContainer.replaceChild(dataTable, imageDataContainer.childNodes[0]);
}

showViewerImage();

var inputElements = document.getElementsByClassName("input");
Array.from(inputElements).forEach(function(element) {
	element.onclick = showViewerImage;
});

document.addEventListener("keydown", function(e) {
	var selectedImageName;
	Array.from(imageNameElement.children).forEach(function(element) {
		if (element.selected) selectedImageName = element;
	})

	var scenarioArray = Array.from(scenarioElements);
	var scenarioIndex;
	for (scenarioIndex = 0; scenarioIndex < scenarioArray.length; ++scenarioIndex) {
		if (scenarioArray[scenarioIndex].checked) break;
	}

	var breakpointArray = Array.from(breakpointElements);
	var breakpointIndex;
	for (breakpointIndex = 0; breakpointIndex < breakpointArray.length; ++breakpointIndex) {
		if (breakpointArray[breakpointIndex].checked) break;
	}

	var subsamplingArray = Array.from(subsamplingElements);
	var subsamplingIndex;
	for (subsamplingIndex = 0; subsamplingIndex < subsamplingArray.length; ++subsamplingIndex) {
		if (subsamplingArray[subsamplingIndex].checked) break;
	}

	var qualityArray = Array.from(qualityElements);
	var qualityIndex;
	for (qualityIndex = 0; qualityIndex < qualityArray.length; ++qualityIndex) {
		if (qualityArray[qualityIndex].checked) break;
	}

	var displayArray = Array.from(displayElements);
	var displayIndex;
	for (displayIndex = 0; displayIndex < displayArray.length; ++displayIndex) {
		if (displayArray[displayIndex].checked) break;
	}

	switch (e.keyCode) {
		case  38: // up key
		case  40: // down key
			var toSelect = (e.keyCode == 38) ? selectedImageName.previousElementSibling : selectedImageName.nextElementSibling;
			if (null != toSelect) {
				toSelect.selected = true;
				showViewerImage();
			}
			e.preventDefault();
			break;
		case  83: // s key
			var newIndex = scenarioIndex + 1;
			var length = scenarioArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			scenarioArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case 189: // - key
		case 187: // = key
		case  66: // b key
			var newIndex = breakpointIndex + (e.keyCode == 187 ? -1 : 1);
			var length = breakpointArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			breakpointArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  67: // c key
			var newIndex = subsamplingIndex + 1;
			var length = subsamplingArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			subsamplingArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  68: // d key
			var newIndex = displayIndex + 1;
			var length = displayArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			displayArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
		case  37: // left key
		case  39: // right key
		case  81: // q key
			var newIndex = qualityIndex + (e.keyCode == 37 ? -1 : 1);
			var length = qualityArray.length;
			while (newIndex < 0           ) newIndex += length;
			while (newIndex > (length - 1)) newIndex -= length;
			qualityArray[newIndex].checked = true;
			showViewerImage();
			e.preventDefault();
			break;
	}
});
		</script>
	</body>
</html>